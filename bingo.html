<!DOCTYPE html>
<html>
  <head>
    <base href="https://game76420.github.io/" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bingo 遊戲</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap");

      :root {
        --main-bg-color: #0080ff;
        --secondary-bg-color: #003366;
        --highlight-color: #ffd700;
        --cell-bg-color: #ffa500;
        --selected-cell-color: #00bfff;
        --text-color: #ffffff;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        height: 100%;
        margin: 0; /* 确保没有默认的边距 */
        overflow: hidden;
      }

      body {
        font-family: "Poppins", "Arial", sans-serif;
        background: radial-gradient(
          circle,
          var(--main-bg-color) 0%,
          var(--secondary-bg-color) 100%
        );
        color: var(--text-color);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
      }

      .game-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        margin: 0;
        padding: 20px;
        min-height: 100vh; /* 新增此行以確保容器至少填滿視口高度 */
      }

      #board {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 1vh;
        width: 90%;
        height: 90%;
        margin: 20px auto;
        aspect-ratio: 1 / 1;
      }

      .cell {
        background-color: var(--cell-bg-color);
        border: 2px solid var(--highlight-color);
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: clamp(1.5rem, 5vw, 2rem); /* 调整最大字体大小 */
        font-weight: bold;
        color: var(--secondary-bg-color);
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 2px rgba(0, 0, 0, 0.2);
        aspect-ratio: 1 / 1;
        text-align: center;
        /* width: 12vh;  */ /* 移除原本設定的固定大小 */
        /* height: 12vh;  */ /* 移除原本設定的固定大小 */
        border-radius: 50%; /* 确保为圆形 */
      }

      .cell:hover {
        transform: scale(1.05);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
      }

      .selected {
        background-color: var(--selected-cell-color);
        color: var(--text-color);
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      #selected-number {
        font-size: clamp(1rem, 3vw, 1.5rem);
        margin: 20px 0;
        font-weight: bold;
        color: var(--highlight-color);
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        text-align: center; /* 新增此行以置中對齊文字 */
      }

      .button-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
        position: fixed; /* 设置固定定位 */
        bottom: 20px; /* 设置底部距离屏幕底部的距离 */
        left: 50%;
        transform: translateX(-50%); /* 水平居中 */
        width: 90%; /* 按钮区域的宽度 */
      }

      button {
        padding: 8px 16px;
        font-size: clamp(0.7rem, 2vw, 0.9rem);
        font-weight: bold;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        background-color: var(--highlight-color);
        color: var(--secondary-bg-color);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        outline: none; /* 新增此行以隱藏焦點樣式 */
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
      }

      #draw-number-btn {
        background-color: var(--selected-cell-color);
        color: var(--text-color);
      }

      #restart-btn {
        background-color: var(--cell-bg-color);
        color: var(--secondary-bg-color);
      }

      .zoom-effect {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        font-size: 10vw;
        color: red;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(255, 255, 255, 1);
        opacity: 1;
        transition: transform 0.5s ease, opacity 0.5s ease;
        pointer-events: none;
        text-shadow: 
          2px 2px 0 white,  
          -2px -2px 0 white,
          2px -2px 0 white,
          -2px 2px 0 white; /* 增加偏移量以加粗外框笔画效果 */
      }

      .zoom-effect.show {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }

      .zoom-effect.hide {
        opacity: 0;
      }

      @media (max-width: 480px) {
        .game-container {
          padding: 10px;
        }

        #board {
          width: 90vw;
          height: 90vw;
        }

        .button-container {
          flex-direction: column;
          align-items: center;
        }

        button {
          width: 100%;
          margin-bottom: 5px;
        }
      }
    </style>
  </head>
  <body>
    <div>
      <div id="board"></div>
      <div id="selected-number">請按下「選擇號碼」開始遊戲</div>
      <div class="button-container">
        <button id="draw-number-btn">開始擇號碼</button>
        <button id="restart-btn">重新開始遊戲</button>
        <button id="toggle-bgm">播放背景音樂</button>
      </div>
    </div>

    <audio id="number-sound" src="sound01.mp3" preload="auto"></audio>
    <audio id="bgm" src="bgm.mp3" loop preload="auto"></audio>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script>
      const boardElement = document.getElementById("board");
      const selectedNumberElement = document.getElementById("selected-number");
      const drawNumberBtn = document.getElementById("draw-number-btn");
      const restartBtn = document.getElementById("restart-btn");

      let numbers = Array.from({ length: 25 }, (_, i) => i + 1);
      let availableNumbers = [...numbers];
      let selectedNumbers = new Set();
      let intervalId;
      let isDrawing = false;
      let isEnterPressed = false;
      let isGameRestarted = false; // 增此行

      function initBoard() {
        boardElement.innerHTML = "";
        numbers.forEach((number) => {
          const cell = document.createElement("div");
          cell.classList.add("cell");
          cell.textContent = number;
          cell.onclick = () => toggleNumberSelection(number, cell);
          boardElement.appendChild(cell);
        });
      }

      function toggleNumberSelection(number, cell) {
        if (selectedNumbers.has(number)) return;

        selectedNumbers.add(number);
        cell.classList.add("selected");

        setTimeout(() => {
          const selectSound = new Audio("sound02.mp3");
          selectSound.play();
        }, 500);

        const effectElement = document.createElement("div");
        effectElement.className = "zoom-effect show";
        effectElement.textContent = number;
        document.body.appendChild(effectElement);

        setTimeout(() => {
          effectElement.classList.remove("show");
          effectElement.classList.add("hide");
          setTimeout(() => {
            document.body.removeChild(effectElement);
          }, 500);
        }, 2000);
      }

      function celebrateNumber() {
        confetti({
          particleCount: 100,
          spread: 70,
          origin: { y: 0.6 },
          colors: ["#FFD700", "#FFA500", "#00BFFF", "#0080FF"],
        });

        confetti({
          particleCount: 50,
          spread: 70,
          origin: { y: 0.6 },
          colors: ["#FFD700", "#FFA500", "#00BFFF"],
          shapes: ["circle"],
          scalar: 0.7,
        });
      }

      function drawNumber() {
        if (isDrawing) return;
        isDrawing = true;

        if (availableNumbers.length === 0) {
          selectedNumberElement.textContent =
            "所有號碼均已選擇，請重新開始遊戲！";
          drawNumberBtn.style.display = "none";
          isDrawing = false;
          return;
        }

        let number;
        let count = 0;

        intervalId = setInterval(() => {
          const randomIndex = Math.floor(Math.random() * availableNumbers.length);
          number = availableNumbers[randomIndex];
          selectedNumberElement.textContent = `選擇的碼: ${number}`;

          const sound = document.getElementById("number-sound");
          sound.currentTime = 0;
          sound.play();

          const cells = document.querySelectorAll(".cell");
          cells.forEach((cell) => {
            if (parseInt(cell.textContent) === number) {
              cell.style.backgroundColor = "#00BFFF";
              cell.style.color = "#fff";
            } else if (selectedNumbers.has(parseInt(cell.textContent))) {
              cell.style.backgroundColor = "#00BFFF";
              cell.style.color = "#fff";
            } else {
              cell.style.backgroundColor = "";
              cell.style.color = "";
            }
          });

          count++;
          if (count >= 20) {
            clearInterval(intervalId);
            revealNumber(number);
          }
        }, 100);

        document.getElementById("number-sound").play();
      }

      function revealNumber(number) {
        availableNumbers = availableNumbers.filter((num) => num !== number);
        selectedNumbers.add(number);
        selectedNumberElement.textContent = `幸運號碼是: ${number}`;
        celebrateNumber();

        const selectSound = new Audio("sound02.mp3");
        selectSound.play().catch((error) => {
          console.error("播放音效時出錯:", error);
        });

        const effectElement = document.createElement("div");
        effectElement.className = "zoom-effect show";
        effectElement.textContent = number;
        document.body.appendChild(effectElement);

        setTimeout(() => {
          effectElement.classList.remove("show");
          effectElement.classList.add("hide");
          setTimeout(() => {
            document.body.removeChild(effectElement);
          }, 500);
        }, 2000);

        const cells = document.querySelectorAll(".cell");
        cells.forEach((cell) => {
          if (selectedNumbers.has(parseInt(cell.textContent))) {
            cell.classList.add("selected");
          }
        });

        isDrawing = false;
      }

      function restartGame() {
        selectedNumbers.clear();
        availableNumbers = [...numbers];
        selectedNumberElement.textContent = "請按下「選擇號碼」開始遊戲";
        drawNumberBtn.style.display = "inline-block";
        initBoard();
        isGameRestarted = true; // 新增此行
        restartBtn.blur(); // 移除焦點
      }

      drawNumberBtn.addEventListener("click", drawNumber);
      restartBtn.addEventListener("click", () => {
        restartGame();
        restartBtn.blur(); // 移除焦點
      });

      document.addEventListener("keydown", (event) => {
        if (event.key === "Enter" && !isEnterPressed) {
          isEnterPressed = true;
          drawNumber(); // 直接調用 drawNumber 函數
        }
      });

      document.addEventListener("keyup", (event) => {
        if (event.key === "Enter") {
          isEnterPressed = false;
          isGameRestarted = false; // 新增此行
        }
      });

      const toggleBgmBtn = document.getElementById("toggle-bgm");
      const bgm = document.getElementById("bgm");

      toggleBgmBtn.addEventListener("click", () => {
        if (bgm.paused) {
          bgm.play()
            .then(() => {
              toggleBgmBtn.textContent = "停止背景音樂";
            })
            .catch((error) => {
              console.error("播放背景音樂時出錯:", error);
            });
        } else {
          bgm.pause();
          bgm.currentTime = 0;
          toggleBgmBtn.textContent = "播放背景音樂";
        }
        toggleBgmBtn.blur(); // 移除焦點
      });

      //   动播放背景音乐
      window.onload = () => {
        bgm.play()
          .then(() => {
            toggleBgmBtn.textContent = "停止背景音樂"; // 更新按鈕文本
          })
          .catch((error) => {
            console.error("自動播放背景音樂時出錯:", error);
          });
      };

      initBoard();

      window.addEventListener("resize", function () {
        const gameContainer = document.querySelector(".game-container");
        const board = document.getElementById("board");
        const buttons = document.querySelectorAll("button");

        gameContainer.style.height = `${window.innerHeight * 0.95}px`;

        const containerWidth = gameContainer.clientWidth;
        const containerHeight = gameContainer.clientHeight;
        const boardSize = Math.min(containerWidth * 0.9, containerHeight * 0.7);
        board.style.width = `${boardSize}px`;
        board.style.height = `${boardSize}px`;

        const buttonSize = Math.min(containerWidth * 0.2, 150);
        buttons.forEach((button) => {
          button.style.width = `${buttonSize}px`;
        });
      });

      window.dispatchEvent(new Event("resize"));
    </script>
  </body>
</html>
